// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common.emevd\u0000N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\m60.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000"
// @linked    [0,72,154,220]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    RegisterBonfire(1049390000, 1049391950, 0, 0, 0, 5);
    //Ladders
    InitializeEvent(0, 1049392203, 0)
    InitializeCommonEvent(0, 90005100, 76418, 76414, 1049391980, 77400, 7, 78400, 78401, 78402, 78403, 78404, 78405, 78406, 78407, 78408, 78409);
    InitializeCommonEvent(0, 9005810, 1049390800, 1049390001, 1049390951, 1049391951, 1084227584);
    RegisterBonfire(1049390002, 1049391952, 0, 0, 0, 5);
    InitializeCommonEvent(0, 90005100, 76418, 76416, 1049391982, 77400, 6, 78400, 78401, 78402, 78403, 78404, 78405, 78406, 78407, 78408, 78409);
    InitializeEvent(0, 1049392210, 0);
    InitializeEvent(0, 1049392211, 1049391200, 1100480512);
    InitializeEvent(1, 1049392211, 1049391201, 1094713344);
    InitializeEvent(2, 1049392211, 1049391202, 1084227584);
    InitializeEvent(3, 1049392211, 1049391203, 1099956224);
    InitializeEvent(4, 1049392211, 1049391204, 1093664768);
    InitializeEvent(5, 1049392211, 1049391205, 1082130432);
    InitializeEvent(7, 1049392211, 1049391207, 1099431936);
    InitializeEvent(8, 1049392211, 1049391208, 1092616192);
    InitializeEvent(10, 1049392211, 1049391210, 1077936128);
    InitializeEvent(12, 1049392211, 1049391212, 1098907648);
    InitializeEvent(13, 1049392211, 1049391213, 1091567616);
    InitializeEvent(14, 1049392211, 1049391214, 1073741824);
    InitializeEvent(15, 1049392211, 1049391215, 1065353216);
    InitializeEvent(16, 1049392211, 1049391216, 1096810496);
    InitializeEvent(17, 1049392211, 1049391217, 1088421888);
    InitializeEvent(18, 1049392211, 1049391218, 1091567616);
    InitializeEvent(19, 1049392211, 1049391219, 1096810496);
    InitializeEvent(20, 1049392211, 1049391220, 1091567616);
    InitializeEvent(21, 1049392211, 1049391221, 1077936128);
    InitializeEvent(22, 1049392211, 1049391222, 1096810496);
    InitializeEvent(23, 1049392211, 1049391223, 1065353216);
    InitializeEvent(24, 1049392211, 1049391224, 1098907648);
    InitializeEvent(25, 1049392211, 1049391226, 1099431936);
    InitializeEvent(26, 1049392211, 1049391227, 1073741824);
    InitializeEvent(27, 1049392211, 1049391228, 1099956224);
    InitializeEvent(28, 1049392211, 1049391229, 1100480512);
    InitializeEvent(0, 1049392580, 49390580, 49390851, 1049391580);
    InitializeEvent(1, 1049392580, 49390582, 49390853, 1049391582);
    InitializeEvent(0, 1049392300, 1049391650, 1049390200);
    InitializeEvent(1, 1049392301, 1049391651, 1049390201);
    InitializeEvent(1, 1049392302, 1049391601, 1049390201);
    InitializeEvent(0, 1049392303, 1049391600, 1049390200);
    InitializeEvent(0, 1049392304, 1049391652, 1049390201);
    InitializeEvent(0, 1049392849, 0);
    InitializeEvent(0, 1049390800, 0);
    InitializeEvent(0, 1049392810, 0);
    InitializeCommonEvent(0, 9005811, 1049390800, 1049391801, 3, 0);
    InitializeCommonEvent(0, 90005880, 1049390850, 1049390855, 1049392850, 1049390850, 1049390850, 2568508, 1049392855);
    InitializeCommonEvent(0, 90005881, 1049390850, 1049390855, 1049392851, 1049392852, 20300, 1049391855, 2568508, 1049392855);
    InitializeCommonEvent(0, 90005882, 1049390850, 1049390855, 1049392850, 1049390850, 1049392856, 1049395860, 1049391850, 1049390860, 1049392860, 903704520, -1, 20004);
    InitializeCommonEvent(0, 90005883, 1049390850, 1049390855, 1049391855);
    InitializeCommonEvent(0, 90005885, 1049390850, 0, 1049392856, 1049392857, 0, 1);
    InitializeCommonEvent(0, 90005251, 1049390200, 1099431936, 0, -1);
    InitializeCommonEvent(0, 90005251, 1049390204, 1090519040, 0, -1);
    InitializeCommonEvent(0, 90005251, 1049390208, 1099431936, 0, -1);
    InitializeEvent(0, 1049392200, 1049390200, 14809);
    InitializeEvent(1, 1049392200, 1049390201, 14807);
    InitializeEvent(2, 1049392200, 1049390202, 14809);
    InitializeEvent(3, 1049392200, 1049390309, 10113);
    InitializeEvent(4, 1049392200, 1049390204, 14807);
    InitializeEvent(5, 1049392200, 1049390205, 14809);
    InitializeEvent(7, 1049392200, 1049390207, 14808);
    InitializeEvent(9, 1049392200, 1049390208, 14809);
    InitializeCommonEvent(0, 90005201, 1049390296, 30000, 20000, 1101004800, 0, 0, 0, 0, 0);
    InitializeEvent(0, 1049392350, 1049390299, 12603, 1049392299, 1049392298, 1049392297);
    InitializeCommonEvent(0, 90005300, 1049390299, 1049390299, 40418, 0, 0);
    InitializeCommonEvent(0, 90005300, 1049390298, 1049390298, 40416, 0, 0);
    InitializeEvent(0, 1049392201, 1049390308, 10113, 1077936128, 1084227584);
    InitializeEvent(2, 1049392201, 1049390310, 10113, 1086324736, 1073741824);
    InitializeEvent(3, 1049392201, 1049390203, 10113, 1091567616, 1077936128);
    InitializeCommonEvent(0, 90005250, 1049390405, 1049392405, 0, -1);
    //Warp to Nokstella
    InitializeEvent(0, 1049392874, 0);
    InitializeEvent(0, 1049392811, 0);
    //Mushroom Men Ambush
    InitializeEvent(0, 1049392878, 1049391250, 1049391251);
    InitializeEvent(1, 1049392878, 1049391250, 1049391252);
    InitializeEvent(2, 1049392878, 1049391250, 1049391253);
    InitializeEvent(3, 1049392878, 1049391250, 1049391254);
    InitializeEvent(4, 1049392878, 1049391250, 1049391255);
    InitializeEvent(5, 1049392878, 1049391250, 1049391256);
    InitializeEvent(6, 1049392878, 1049391250, 1049391257);
    InitializeEvent(7, 1049392878, 1049391250, 1049391258);
    InitializeEvent(8, 1049392878, 1049391250, 1049391259);
    InitializeEvent(9, 1049392878, 1049391250, 1049391260);
    //Marionette Ambush
    InitializeEvent(0, 1049392877, 1049392401, 1049391135, 0);
    InitializeEvent(1, 1049392877, 1049392401, 1049391136, 2);
    InitializeEvent(2, 1049392877, 1049392402, 1049391137, 1);
    
    InitializeEvent(0, 1049392876, 1049390855, 1049390856, 1049390857, 1049390818, 1049392407);                                                            //Meteoers Nox
    InitializeEvent(1, 1049392876, 1049390865, 1049390866, 1049390867, 1049390818, 1049392408);                                                            //Meteoers Rot
    InitializeEvent(0, 1049392875, 1049390811, 1049390812, 1049390813, 1049390814, 1049390815, 1049390816, 1049390817, 1049390818, 1049390819);            //Gravity Team Setup
    InitializeEvent(0, 1049392879, 1049391661, 1049391662, 1049391663, 1049391653, 1049390819);                                                            //Gravity Gate Control
    InitializeEvent(0, 1049392861, 1049390811, 1049390812, 1049390813, 1049390814, 1049390815, 1049390816, 1049390817, 1049390818, 1049390822);//Disable Team Gravity
    InitializeEvent(1, 1049392861, 1049390831, 1049390832, 1049390833, 1049390834, 1049390835, 1049390836);                                                //Disable Team Nox
    InitializeEvent(2, 1049392861, 1049390840, 1049390841, 1049390842, 1049390843, 1049390844, 1049390845, 1049390846, 1049390847);                        //Disable Team Rot
    
    //Battle Handlers
    InitializeEvent(0, 1049392863, 0);
    InitializeEvent(0, 1049392864, 0);
    
    //Past Grav Gate Enemies
    InitializeEvent(0, 1049392880, 1049390821);
    InitializeEvent(1, 1049392880, 1049390822);
    InitializeEvent(2, 1049392880, 1049390823);
    InitializeEvent(3, 1049392880, 1049390824);
    InitializeEvent(4, 1049392880, 1049390825);
    InitializeEvent(5, 1049392880, 1049390826);
    InitializeEvent(6, 1049392880, 1049390827);
    InitializeEvent(7, 1049392880, 1049390828);
    InitializeEvent(8, 1049392880, 1049390829);
    InitializeEvent(9, 1049392880, 1049390830);
    InitializeEvent(10, 1049392880, 1049390837);
    InitializeEvent(11, 1049392880, 1049390838);
    
    DisableMapPart(1049392120);
    DisableMapPart(1049392121);
    DisableMapPart(1049392122);
    DisableMapPart(1049392123);
    
    InitializeCommonEvent(0, 900005610, 1049392130, 100, 800, 0);
    InitializeCommonEvent(1, 900005610, 1049392131, 100, 800, 0);
    InitializeCommonEvent(2, 900005610, 1049392132, 100, 800, 0);
    InitializeCommonEvent(3, 900005610, 1049392133, 100, 800, 0);
    
    //SaliaMoon
    InitializeCommonEvent(0, 90005250, 1049390953, 1049390954, 0, -1); //trigger box
    InitializeCommonEvent(0, 90005300, 1049390953, 1049390953, 108000 , 0, 0);
});

$Event(1049392200, Restart, function(X0_4, X4_4) {
    DisableNetworkSync();
    SetSpEffect(X0_4, X4_4);
});

$Event(1049392201, Restart, function(X0_4, X4_4, X8_4, X12_4) {
    DisableNetworkSync();
    SetSpEffect(X0_4, X4_4);
    WaitFixedTimeSeconds(X12_4);
    ClearSpEffect(X0_4, X4_4);
    WaitFixedTimeSeconds(X8_4);
    RestartEvent();
});

//Ladders
$Event(1049392203, Default, function() {
    RegisterLadder(1049392011, 1049392001, 1049392101);
    RegisterLadder(1049392012, 1049392002, 1049392102);
    RegisterLadder(1049392013, 1049392003, 1049392103);
    RegisterLadder(1049392014, 1049392004, 1049392105);
    RegisterLadder(1049392015, 1049392005, 1049392106);
    RegisterLadder(1049392016, 1049392006, 1049392107);
    RegisterLadder(1049392017, 1049392007, 1049392108);
    InitializeCommonEvent(0, 90005520, 1049390114, 1049392104, 1049392014, 1049392004); // Kick Ladder
    EndEvent();
});

$Event(1049392210, Restart, function() {
    CreateBulletOwner(1049390297);
});

$Event(1049392211, Restart, function(X0_4, X4_4) {
    EnableNetworkSync();
    WaitFixedTimeSeconds(8);
    WaitFor(EntityInRadiusOfEntity(10000, X0_4, 70, 1));
    WaitFixedTimeSeconds(X4_4);
    if (GameCycle() == 0) {
        ShootBullet(1049390297, X0_4, -1, 802700000, 0, 0, 0);
    } else if (GameCycle() == 1) {
        ShootBullet(1049390297, X0_4, -1, 802700010, 0, 0, 0);
    } else if (GameCycle() == 2) {
        ShootBullet(1049390297, X0_4, -1, 802700020, 0, 0, 0);
    } else if (GameCycle() == 3) {
        ShootBullet(1049390297, X0_4, -1, 802700030, 0, 0, 0);
    } else if (GameCycle() == 4) {
        ShootBullet(1049390297, X0_4, -1, 802700040, 0, 0, 0);
    } else if (GameCycle() == 5) {
        ShootBullet(1049390297, X0_4, -1, 802700050, 0, 0, 0);
    } else if (GameCycle() == 6) {
        ShootBullet(1049390297, X0_4, -1, 802700060, 0, 0, 0);
    } else if (GameCycle() >= 7) {
        ShootBullet(1049390297, X0_4, -1, 802700070, 0, 0, 0);
        Goto(L0);
    }
L0:
    RestartEvent();
});

$Event(1049392300, Default, function(X0_4, X4_4) {
    EnableNetworkSync();
    CreateAssetfollowingSFX(X0_4, 200, 1502);
    WaitFor(EventFlag(X4_4));
    PlaySE(X0_4, SoundType.SFX, 1500);
    DisableAsset(X0_4);
    DeleteAssetfollowingSFX(X0_4, true);
});

$Event(1049392301, Default, function(X0_4, X4_4) {
    EnableNetworkSync();
    CreateAssetfollowingSFX(X0_4, 200, 1501);
    WaitFor(EventFlag(X4_4));
    PlaySE(X0_4, SoundType.SFX, 1500);
    DisableAsset(X0_4);
    DeleteAssetfollowingSFX(X0_4, true);
});

$Event(1049392302, Default, function(X0_4, X4_4) {
    EnableNetworkSync();
    if (!EventFlag(X4_4)) {
        WaitFor(PlayerIsInOwnWorld() && ActionButtonInArea(9520, X0_4));
        RotateCharacter(10000, X0_4, -1, true);
        ForceAnimationPlayback(10000, 60010, false, false, false);
        WaitFixedTimeSeconds(1.3);
        SetEventFlagID(X4_4, ON);
        DisplayGenericDialog(30000, PromptType.OKCANCEL, NumberofOptions.OneButton, X0_4, 3);
    }
L0:
    CreateAssetfollowingSFX(X0_4, 100, 806031);
    EndEvent();
});

$Event(1049392303, Default, function(X0_4, X4_4) {
    EnableNetworkSync();
    if (!EventFlag(X4_4)) {
        WaitFor(PlayerIsInOwnWorld() && ActionButtonInArea(9520, X0_4));
        RotateCharacter(10000, X0_4, -1, true);
        ForceAnimationPlayback(10000, 60010, false, false, false);
        WaitFixedTimeSeconds(1.3);
        SetEventFlagID(X4_4, ON);
        SetEventFlagID(1050390200, ON);
        DisplayGenericDialog(30000, PromptType.OKCANCEL, NumberofOptions.OneButton, X0_4, 3);
    }
L0:
    CreateAssetfollowingSFX(X0_4, 100, 806031);
});

$Event(1049392304, Default, function(X0_4, X4_4) {
    EnableNetworkSync();
    CreateAssetfollowingSFX(X0_4, 200, 1501);
    WaitFor(EventFlag(X4_4));
    PlaySE(X0_4, SoundType.SFX, 1500);
    DisableAsset(X0_4);
    DeleteAssetfollowingSFX(X0_4, true);
});

$Event(1049392350, Default, function(X0_4, X4_4, X8_4, X12_4, X16_4) {
    EndIf(CharacterDead(X0_4));
    WaitFor(CharacterHasSpEffect(X0_4, X4_4) && !CharacterDead(X0_4));
    SetEventFlagID(1049392201, OFF);
    SetEventFlagID(1049392202, OFF);
    WaitFixedTimeFrames(1);
    RandomlySetEventFlagInRange(1049392201, 1049392202, ON);
    WaitFixedTimeFrames(1);
    GotoIf(L1, InArea(X0_4, X8_4));
    GotoIf(L2, InArea(X0_4, X12_4));
    GotoIf(L3, InArea(X0_4, X16_4));
L1:
    GotoIf(S0, EventFlag(1049392201));
    Goto(S1);
S0:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X12_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
S1:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X16_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
L2:
    GotoIf(S2, EventFlag(1049392201));
    Goto(S3);
S2:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X8_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
S3:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X16_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
L3:
    GotoIf(S4, EventFlag(1049392201));
    Goto(S5);
S4:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X8_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
S5:
    WarpCharacterAndCopyFloor(X0_4, TargetEntityType.Area, X12_4, -1, X0_4);
    ForceAnimationPlayback(X0_4, 20025, true, false, false);
    Goto(L0);
L0:
    RequestCharacterAIReplan(X0_4);
    WaitFixedTimeSeconds(1);
    RestartEvent();
});

$Event(1049392580, Default, function(X0_4, X4_4, X8_4) {
    RegisterLadder(X0_4, X4_4, X8_4);
});

$Event(1049390800, Restart, function() {
    EndIf(EventFlag(1049390800));
    WaitFor(CharacterHPValue(1049390800) <= 0 && CharacterHPValue(1049390801) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(1049390800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(1049390800));
    HandleBossDefeatAndDisplayBanner(1049390800, TextBannerType.EnemyFelled);
    SetSpEffect(10000, 3450);
    if (PlayerIsInOwnWorld()) {
        AwardItemsIncludingClients(1049390800);
    }
    SetEventFlagID(1049390800, ON);
});

$Event(1049392810, Restart, function() {
    if (EventFlag(1049390800)) {
        DisableCharacter(1049390800);
        DisableCharacterCollision(1049390800);
        ForceCharacterDeath(1049390800, false);
        DisableCharacter(1049390801);
        DisableCharacterCollision(1049390801);
        ForceCharacterDeath(1049390801, false);
        EndEvent();
    }
L0:
    EnableCharacterInvincibility(1049390800);
    EnableCharacterInvincibility(1049390801);
    DisableCharacterAI(1049390800);
    DisableCharacterAI(1049390801);
    WaitFor(EventFlag(1049392805) && InArea(10000, 1049392800) && EventFlag(1049392805));
    DisableCharacterInvincibility(1049390800);
    DisableCharacterInvincibility(1049390801);
    EnableCharacterAI(1049390800);
    EnableCharacterAI(1049390801);
    SetNetworkUpdateRate(1049390800, true, CharacterUpdateFrequency.AlwaysUpdate);
    SetNetworkUpdateRate(1049390801, true, CharacterUpdateFrequency.AlwaysUpdate);
    DisplayBossHealthBar(Enabled, 1049390800, 0, 903300560);
    DisplayBossHealthBar(Enabled, 1049390801, 1, 903300561);
});

$Event(1049392849, Restart, function() {
    InitializeCommonEvent(0, 9005800, 1049390800, 1049391800, 1049392800, 1049392805, 1049395800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 1049390800, 1049391800, 1049392800, 1049392805, 1049392806, 10000);
    InitializeCommonEvent(0, 9005811, 1049390800, 1049391800, 4, 0);
    InitializeCommonEvent(0, 9005822, 1049390800, 920900, 1049392805, 1049392806, 0, 1049392802, 0, 0);
});

$Event(1049392874, Restart, function() {
    WaitFor(EventFlag(1049390800));
    CreateAssetfollowingSFX(1049390875, 200, 806870);
    IfActionButtonInArea(MAIN, 9140, 1049390875);
    RotateCharacter(10000, 1049390875, -1, true);
    ForceAnimationPlayback(10000, 60490, false, false, false, Equal, 1);
    WaitFixedTimeSeconds(3);
    WarpPlayer(12, 1, 0, 0, 12010876, 60);
    RestartEvent();
});

// Disable Teams
$Event(1049392861, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4, X36_4) {
    DisableCharacter(X0_4);
    DisableCharacter(X4_4);
    DisableCharacter(X8_4);
    DisableCharacter(X12_4);
    DisableCharacter(X16_4);
    DisableCharacter(X20_4);
    DisableCharacter(X24_4);
    DisableCharacter(X28_4);
    DisableCharacter(X32_4);
    DisableCharacter(X36_4);
});

// Enable Team
$Event(1049392862, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4, X36_4) {
    EnableCharacter(X0_4);
    EnableCharacter(X4_4);
    EnableCharacter(X8_4);
    EnableCharacter(X12_4);
    EnableCharacter(X16_4);
    EnableCharacter(X20_4);
    EnableCharacter(X24_4);
    EnableCharacter(X28_4);
    EnableCharacter(X32_4);
    EnableCharacter(X36_4);
});

// Nox Side Handler
$Event(1049392863, Restart, function() {
    EndIf(EventFlag(1049390015));
    WaitFor(InArea(10000, 1049392407) && !EventFlag(1049390017));
    SetEventFlagID(1049390016, ON)     // Nox Side is on
    
    //Disable closeby starcallers
    DisableCharacter(1049390825);
    DisableCharacter(1049390824);
    DisableCharacter(1049390823);
    
    InitializeEvent(0, 1049392862, 1049390811, 1049390812, 1049390813, 1049390814, 1049390815, 1049390822);  //Enable First Team Gravity
    InitializeEvent(1, 1049392862, 1049390831, 1049390832, 1049390833);                                      //Enable First Team Nox
    WaitFor(ElapsedSeconds(25) || InArea(10000, 1049392404) || InArea(10000, 1049392409));
    InitializeEvent(0, 1049392862, 1049390816, 1049390817, 1049390818);                          //Enable Second Team Gravity
    // Special Effects for Elite starcallers | scaling and gravity armor
    SetSpEffect(1049390816, 1477000);
    SetSpEffect(1049390816, 7120);
    SetSpEffect(1049390817, 1477000);
    SetSpEffect(1049390817, 7120);
    InitializeEvent(1, 1049392862, 1049390834, 1049390835, 1049390836);                                      //Enable Second Team Nox  
    EndEvent();
});

// Rot Side Handler
$Event(1049392864, Restart, function() {
    EndIf(EventFlag(1049390015));
    WaitFor(InArea(10000, 1049392408) && !EventFlag(1049390016));
    SetEventFlagID(1049390017, ON)     // Rot Side is on
    InitializeEvent(0, 1049392862, 1049390811, 1049390812, 1049390813, 1049390814, 1049390815, 1049390822);                        //Enable First Team Gravity
    InitializeEvent(1, 1049392862, 1049390840, 1049390841, 1049390842, 1049390843, 1049390844, 1049390845, 1049390846, 1049390847);//Enable Team Rot
    WaitFor(ElapsedSeconds(21) || InArea(10000, 1049392404));
    InitializeEvent(0, 1049392862, 1049390816, 1049390817, 1049390818);                                                //Enable Second Team Gravity
    // Special Effects for Elite starcallers | scaling and gravity armor
    SetSpEffect(1049390816, 1477000);
    SetSpEffect(1049390816, 7120);
    SetSpEffect(1049390817, 1477000);
    SetSpEffect(1049390817, 7120);
    EndEvent();
});

//Setup Gravity Team
$Event(1049392875, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4) {
    EndIf(EventFlag(1049390015));
    SetCharacterTeamType(X0_4, TeamType.Enemy2);
    SetCharacterTeamType(X4_4, TeamType.Enemy2);
    SetCharacterTeamType(X8_4, TeamType.Enemy2);
    SetCharacterTeamType(X12_4, TeamType.Enemy2);
    SetCharacterTeamType(X16_4, TeamType.Enemy2);
    SetCharacterTeamType(X20_4, TeamType.Enemy2);
    SetCharacterTeamType(X24_4, TeamType.Enemy2);
    SetCharacterTeamType(X28_4, TeamType.Enemy2);
    SetCharacterTeamType(X32_4, TeamType.Enemy2);
    EndEvent();
});

//Meteoer Shower, start of Battle.
$Event(1049392876, Default, function(X0_4, X4_4, X8_4, X12_4, X16_4) {
    EndIf(EventFlag(1049390015));
    EndIf(EventFlag(1049390016));
    EndIf(EventFlag(1049390017));
    WaitFor(InArea(10000, X16_4));
    WaitFixedTimeSeconds(2);
    ShootBullet(X12_4, X0_4, -1, 236000800, 0, 0, 0);
    ShootBullet(X12_4, X0_4, -1, 236000830, 0, 0, 0);
    ShootBullet(X12_4, X0_4, -1, 236000810, 0, 0, 0);
    WaitFixedTimeSeconds(2);
    ShootBullet(X12_4, X4_4, -1, 236000800, 0, 0, 0);
    ShootBullet(X12_4, X4_4, -1, 236000830, 0, 0, 0);
    ShootBullet(X12_4, X4_4, -1, 236000810, 0, 0, 0);
    ShootBullet(X12_4, X4_4, -1, 236000840, 0, 0, 0);
    WaitFixedTimeSeconds(2);
    ShootBullet(X12_4, X8_4, -1, 236000800, 0, 0, 0);
    ShootBullet(X12_4, X8_4, -1, 236000810, 0, 0, 0);
    ShootBullet(X12_4, X8_4, -1, 236000840, 0, 0, 0);
    EndEvent();
});

// Trigger for Marionette Ambush
// Arguments: Area, Enemy, Delay
$Event(1049392877, Restart, function(X0_4, X4_4, X8_4) {
    WaitFor(InArea(10000, X0_4));
    WaitFixedTimeSeconds(X8_4);
    ForceAnimationPlayback(X4_4, 701, false, false, true, Equal, 1);
    EndEvent();
});

// Trigger for Mushroom Men Ambush
// Arguments: Area, Enemy
$Event(1049392878, Restart, function(X0_4, X4_4) {
    DisableCharacterAI(X4_4);
    WaitFor(InArea(10000, X0_4) || HasDamageType(X4_4, 10000, DamageType.Unspecified));
    WaitRandomTimeSeconds(1, 6) // we like some randomness
    EnableCharacterAI(X4_4);
    EndEvent();
});

//Gravity Gate Controller
$Event(1049392879, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4) {
    if (!EventFlag(1049390015)) {
        CreateAssetfollowingSFX(X12_4, 200, 636003);
        SpawnMapSFX(X0_4);
        SpawnMapSFX(X4_4);
        SpawnMapSFX(X8_4);
        
        SetEventFlagID(1049390017, OFF)
        SetEventFlagID(1049390016, OFF)
        
        WaitFor(CharacterDead(X16_4) || InArea(10000, 1049392406));
        AwardItemsIncludingClients(1049390150);
        SetEventFlagID(1049390015, ON)
        SpawnOneshotSFX(0, X12_4, 200, 304631);
        DeleteAssetfollowingSFX(X12_4, false);
        DisableAsset(X12_4);
        DeleteMapSFX(X0_4, false);
        DeleteMapSFX(X4_4, false);
        DeleteMapSFX(X8_4, false);
    } else {
        SetEventFlagID(1049390017, ON)
        SetEventFlagID(1049390016, ON)
        DisableCharacter(X16_4);
        DisableAsset(X12_4);
        DeleteMapSFX(X0_4, false);
        DeleteMapSFX(X4_4, false);
        DeleteMapSFX(X8_4, false);
    }
    EndEvent();
});

//Disable Character if Grav Gate is up
$Event(1049392880, Restart, function(X0_4) {
    if (!EventFlag(1049390015)) {
        DisableCharacter(X0_4); 
        WaitFor(CharacterDead(1049390819) || InArea(10000, 1049392406));
        EnableCharacter(X0_4);
    }
    EndEvent();
});
