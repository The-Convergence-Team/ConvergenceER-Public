// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    InitializeEvent(0, 1051362580, 0);
    InitializeCommonEvent(0, 9005810, 1051360800, 1051360000, 1051360950, 1051361950, 1084227584);
    InitializeCommonEvent(0, 90005100, 76458, 76419, 1051361981, 77410, 4, 78410, 78411, 78412, 78413, 78414, 78415, 78416, 78417, 78418, 78419);
    RegisterBonfire(1051360001, 1051361951, 0, 0, 0, 10);
    RegisterBonfire(1051360002, 1051361952, 0, 0, 0, 10);
    RegisterBonfire(1051360003, 1051361953, 0, 0, 0, 10);
    InitializeCommonEvent(0, 90005100, 76458, 76420, 1051361980, 77410, 3, 78410, 78411, 78412, 78413, 78414, 78415, 78416, 78417, 78418, 78419);
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004070, 1065353216, 0, 1065353216);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004060, 1065353216, 0, 1065353216);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004050, 1065353216, 0, 1065353216);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004040, 1065353216, 0, 1065353216);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004030, 1065353216, 0, 1065353216);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004020, 1065353216, 0, 1065353216);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004010, 1065353216, 0, 1065353216);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005695, 1051362501, 1051361501, 200, 0, 802004000, 1065353216, 0, 1065353216);
    }
    if (EventFlag(57)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004070, 1065353216, 0, 1065353216);
    }
    if (EventFlag(56)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004060, 1065353216, 0, 1065353216);
    }
    if (EventFlag(55)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004050, 1065353216, 0, 1065353216);
    }
    if (EventFlag(54)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004040, 1065353216, 0, 1065353216);
    }
    if (EventFlag(53)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004030, 1065353216, 0, 1065353216);
    }
    if (EventFlag(52)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004020, 1065353216, 0, 1065353216);
    }
    if (EventFlag(51)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004010, 1065353216, 0, 1065353216);
    }
    if (EventFlag(50)) {
        InitializeCommonEvent(0, 90005695, 1051362503, 1051361503, 200, 0, 802004000, 1065353216, 0, 1065353216);
    }
    InitializeEvent(0, 1051362216, 1051362500, 1051361500, 200, 0, 802004000, 1065353216, 0, 1065353216, 50);
    InitializeEvent(1, 1051362216, 1051362500, 1051361500, 200, 0, 802004010, 1065353216, 0, 1065353216, 51);
    InitializeEvent(2, 1051362216, 1051362500, 1051361500, 200, 0, 802004020, 1065353216, 0, 1065353216, 52);
    InitializeEvent(3, 1051362216, 1051362500, 1051361500, 200, 0, 802004030, 1065353216, 0, 1065353216, 53);
    InitializeEvent(4, 1051362216, 1051362500, 1051361500, 200, 0, 802004040, 1065353216, 0, 1065353216, 54);
    InitializeEvent(5, 1051362216, 1051362500, 1051361500, 200, 0, 802004050, 1065353216, 0, 1065353216, 55);
    InitializeEvent(6, 1051362216, 1051362500, 1051361500, 200, 0, 802004060, 1065353216, 0, 1065353216, 56);
    InitializeEvent(7, 1051362216, 1051362500, 1051361500, 200, 0, 802004070, 1065353216, 0, 1065353216, 57);
    InitializeCommonEvent(0, 900005610, 1051361650, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361655, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361651, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361652, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361653, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361654, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361656, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361657, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361658, 100, 800, 0);
    InitializeCommonEvent(0, 900005610, 1051361659, 100, 800, 0);
    InitializeCommonEvent(0, 90005605, 1051361600, 2372156, 1050360600, 0, 1051362650, 1051362651, 1051362652, 9410, 30040, 0, 0);
    InitializeEvent(0, 1051362800, 0);
    InitializeEvent(0, 1051362810, 0);
    InitializeEvent(0, 1051362811, 0);
    InitializeEvent(0, 1051362849, 0);
    InitializeEvent(0, 1051362630, 1051361630);
    InitializeEvent(1, 1051362630, 1051361631);
    InitializeEvent(2, 1051362630, 1051361632);
    InitializeEvent(3, 1051362630, 1051361633);
    InitializeEvent(0, 1051362210, 0);
    InitializeEvent(0, 1051362215, 0);
    InitializeEvent(0, 1051362200, 0);
    InitializeEvent(0, 1051362220, 0);
    InitializeEvent(0, 1051362230, 0);
    InitializeEvent(0, 1051360736, 0); // Archer
    InitializeCommonEvent(0, 90005261, 1051360200, 1051362200, 1092616192, 0, -1);
    InitializeCommonEvent(0, 90005251, 1051360210, 1092616192, 0, -1);
    InitializeCommonEvent(0, 90005251, 1051360211, 1092616192, 0, -1);
    InitializeCommonEvent(0, 90005300, 1051360291, 1051360291, 1051360700, 0, 0);
    InitializeCommonEvent(0, 90005300, 1051360292, 1051360292, 1051360800, 0, 0);
    InitializeEvent(0, 1051362340, 1051360340);
    InitializeCommonEvent(0, 90005250, 1051360422, 1051362422, 0, -1);
    InitializeCommonEvent(0, 90005250, 1051360474, 1051362422, 0, -1);
    InitializeCommonEvent(0, 90005250, 1051360475, 1051362422, 0, -1);
    InitializeCommonEvent(0, 90005250, 1051360476, 1051362422, 0, -1);
    InitializeCommonEvent(0, 90005250, 1051360490, 1051362490, 0, -1);
    InitializeCommonEvent(0, 90005501, 1051360510, 1051360511, 0, 1051361510, 1051361511, 1051361512, 1051360512);
    InitializeEvent(0, 1051362510, 0);
    InitializeCommonEvent(0, 90005490, 1051360400, 1051360401, 1051361400, 0, 0, 1051362400, 1);
    InitializeCommonEvent(0, 90005490, 1051360402, 1051360403, 1051361402, 0, 0, 1051362402, 1);
    InitializeCommonEvent(0, 90005511, 1051360560, 1051361560, 1051363560, 99020, 0);
    InitializeCommonEvent(0, 90005512, 1051360560, 1051362560, 1051362561);
    InitializeCommonEvent(0, 1051362560, 1051361562);
    InitializeCommonEvent(1, 1051362560, 1051361564);
    InitializeCommonEvent(2, 1051362560, 1051361566);
    InitializeCommonEvent(3, 1051362560, 1051361568);
    InitializeEvent(0, 1051363710, 1051360705);
    InitializeEvent(0, 1051363711, 0);
    InitializeEvent(0, 1051360720, 1051360720);
    InitializeEvent(0, 1051360721, 0);
    InitializeEvent(0, 1051363725, 1051360700);
    InitializeEvent(0, 1051363726, 1051360701);
    InitializeEvent(0, 1051363727, 0);
    InitializeCommonEvent(0, 90005708, 1051360700, 3360, 1051362700);
    InitializeEvent(0, 1051360730, 1051360715, 0, 1);
    InitializeEvent(1, 1051360730, 1051360730, 90100, 1);
    InitializeEvent(2, 1051360730, 1051360735, 90101, 0);
    InitializeEvent(0, 1051360734, 1051360735);
    InitializeEvent(0, 1051360735, 1051360725, 0, 1);
    InitializeEvent(0, 1051362500, 0);
    InitializeEvent(0, 1051362490, 1051362710);
    //Gate+Lever script
    InitializeCommonEvent(0, 90005540, 1051360565, 1051361532, 1051361533, 1051363533, -1, 1, 2); //(eventflag, gate id, lever id, objacteventflag, objactparamid, anim id, anim id)
    InitializeCommonEvent(1, 90005540, 1051360567, 1051361534, 1051361535, 1051363535, -1, 1, 2); 
    InitializeCommonEvent(2, 90005540, 1051360569, 1051361536, 1051361537, 1051363537, -1, 1, 2); 
    InitializeCommonEvent(0, 20000343, 1051360201, 1051360201, 0); 
});

$Event(50, Default, function() {
    SetCharacterBackreadState(1051360700, true);
    SetCharacterBackreadState(1051360701, true);
    SetCharacterBackreadState(1051360702, true);
    SetCharacterBackreadState(1051360705, true);
    SetCharacterBackreadState(1051360715, true);
    SetCharacterBackreadState(1051360720, true);
    SetCharacterBackreadState(1051360725, true);
    SetCharacterBackreadState(1051360730, true);
    SetCharacterBackreadState(1051360735, true);
    SetAssetInvulnerability(1051361700, Enabled);
    InitializeEvent(0, 1051362519, 0);
});

$Event(1051362200, Restart, function() {
    if (EventFlag(9413)) {
        ChangeCharacterEnableState(1051365200, Enabled);
        ChangeAssetEnableState(1051361400, Enabled);
        ChangeAssetEnableState(1051361402, Enabled);
        EndEvent();
    }
    EndIf(!EventFlag(9410));
    WaitFor(EventFlag(9410));
    ChangeCharacterEnableState(1051365200, Disabled);
    ChangeAssetEnableState(1051361400, Disabled);
    ChangeAssetEnableState(1051361402, Disabled);
});

$Event(1051362210, Restart, function() {
    EndIf(!EventFlag(9410) || EventFlag(9413));
    ChangeAssetEnableState(1051361800, Disabled);
    ChangeAssetEnableState(1051361801, Disabled);
});

$Event(1051362215, Restart, function() {
    EndIf(EventFlag(9410) && !EventFlag(9413));
    ChangeAssetEnableState(1051361500, Disabled);
});

$Event(1051362216, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4) {
    EndIf(!EventFlag(X32_4));
    DeleteAssetEvent(X0_4);
    EndIf(!EventFlag(9410) || EventFlag(9413));
    EndIf(AssetDestroyed(X4_4, Equal, 1));
    if (Signed(0) == X12_4) {
        CreateDamagingAsset(X0_4, X4_4, X8_4, X16_4, DamageTargetType.Character, X20_4, X24_4, X28_4);
    } else {
        CreateBigDamagingAsset(X0_4, X4_4, X8_4, X12_4, X16_4, DamageTargetType.Character, X20_4, X24_4, X28_4);
    }
    WaitFor(AssetDestroyed(X0_4, Equal, 1));
    DeleteAssetEvent(X0_4);
});

$Event(1051362220, Restart, function() {
    ChangeAssetEnableState(1051361690, Disabled);
    DeleteAssetfollowingSFX(1051361690, true);
    ReproduceAssetAnimation(1051361520, 0);
    if (!EventFlag(1051360230)) {
        EndIf(EventFlag(9412) || EventFlag(9413) || EventFlag(1252380800));
        if (!EventFlag(9411)) {
            WaitFor(EventFlag(9411));
            SetEventFlag(TargetEventFlagType.EventFlag, 9021, ON);
            PlayCutsceneToPlayer(60510000, CutscenePlayMode.Unskippable, 10000);
            WaitFixedTimeRealFrames(1);
        }
L1:
        ReproduceAssetAnimation(1051361520, 2);
        ChangeAssetEnableState(1051361690, Enabled);
        CreateAssetfollowingSFX(1051361690, 101, 5);
        SetCurrentTime(3, 30, 0, false, false, false, 0, 0, 0);
        ChangeWeather(Weather.Default, -1, false);
        EndEvent();
    }
L2:
    ReproduceAssetAnimation(1051361520, 2);
    EndEvent();
});

$Event(1051362230, Restart, function() {
    EndIf(EventFlag(1051360230));
    WaitFor(EventFlag(9412) && EventFlag(1051360800) && InArea(10000, 1051362230));
    ReproduceAssetAnimation(1051361520, 2);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051360230, ON);
    EndEvent();
});

$Event(1051362340, Restart, function(X0_4) {
    EndIf(EventFlag(1051362340));
    SetCharacterAIState(X0_4, Disabled);
    WaitFor(
        HasDamageType(1051360340, 0, DamageType.Unspecified)
            || CharacterHasStateInfo(X0_4, 436)
            || CharacterHasStateInfo(X0_4, 2)
            || CharacterHasStateInfo(X0_4, 5)
            || CharacterHasStateInfo(X0_4, 6)
            || CharacterHasStateInfo(X0_4, 260)
            || (InArea(10000, 1051362340)
                && ((CharacterType(10000, TargetType.BlackPhantom) && CharacterHasSpEffect(10000, 3710))
                    || CharacterType(10000, TargetType.Alive)
                    || CharacterType(10000, TargetType.GrayPhantom)
                    || CharacterType(10000, TargetType.WhitePhantom))));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051362340, ON);
    SetCharacterAIState(X0_4, Enabled);
    ForceAnimationPlayback(1051360340, 20016, false, true, false, Equal, 1);
    SetCharacterHome(1051360340, 1051362341);
});

$Event(1051362490, Restart, function(X0_4) {
    SetNetworkSyncState(Disabled);
    WaitFor(InArea(20000, X0_4));
    SetSpEffect(20000, 9621);
    WaitFixedTimeSeconds(0.1);
    WaitFor(!InArea(20000, X0_4));
    WaitFixedTimeSeconds(0.1);
    if (!(EventFlag(9410) && !EventFlag(9413) && InArea(20000, 1051362500))) {
        ClearSpEffect(20000, 9621);
    }
    RestartEvent();
});

$Event(1051362500, Restart, function() {
    SetNetworkSyncState(Disabled);
    if (!EventFlag(9413)) {
        WaitFor(
            InArea(20000, 1051362500)
                && EventFlag(9410)
                && !HasMultiplayerState(MultiplayerState.Invasion));
        if (!EventFlag(9413)) {
            SetSpEffect(20000, 9621);
            WaitFixedTimeSeconds(0.1);
            WaitFor(!InArea(20000, 1051362500) || HasMultiplayerState(MultiplayerState.Invasion));
            WaitFixedTimeSeconds(0.1);
            if (!InArea(20000, 1051362710)) {
                ClearSpEffect(20000, 9621);
            }
            RestartEvent();
        }
    }
L0:
    ClearSpEffect(20000, 9621);
    EndEvent();
});

$Event(1051362510, Default, function() {
    InitializeCommonEvent(0, 90005500, 1051360510, 1051360511, 0, 1051361510, 1051361511, 1051363511, 1051361512, 1051363512, 1051362511, 1051362512, 1051360512, 1051360513, 0);
});

$Event(1051362519, Default, function() {
    EndIf(EventFlag(1051360514));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051360514, ON);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051360519, OFF);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051360510, ON);
});

$Event(1051362560, Default, function(X0_4) {
    GotoIf(L0, EventFlag(9413));
    GotoIf(L1, EventFlag(9410));
L0:
    ReproduceAssetAnimation(X0_4, 0);
    EndEvent();
L1:
    EndIf(EventFlag(9413));
    ReproduceAssetAnimation(X0_4, 2);
});

$Event(1051362580, Restart, function() {
    RegisterLadder(1051360580, 1051360581, 1051361580);
    RegisterLadder(1051360582, 1051360583, 1051361582);
    RegisterLadder(1051360584, 1051360585, 1051361584);
    RegisterLadder(1051360588, 1051360589, 1051361588);
    RegisterLadder(1051360590, 1051360591, 1051361590);
    RegisterLadder(1051360592, 1051360593, 1051361592);
    RegisterLadder(1051360592, 1051360593, 1051361593);
    RegisterLadder(1051360594, 1051360595, 1051361594);
    RegisterLadder(1051360596, 1051360597, 1051361596);
    RegisterLadder(1051360596, 1051360597, 1051361589);
    RegisterLadder(1051360596, 1051360597, 1051361591);
    RegisterLadder(1051360596, 1051360597, 1051361592);
});

$Event(1051362630, Restart, function(X0_4) {
    ChangeAssetEnableState(X0_4, Disabled);
});

$Event(1051362650, Restart, function(X0_4, X4_4, X8_4, X12_4, X16_4, X20_4, X24_4, X28_4, X32_4, X36_4, X40_4) {
    WaitFor(EventFlag(1051360800));
    DeleteAssetfollowingSFX(X8_4, false);
    EndIf(!PlayerIsInOwnWorld());
    if (EventFlag(X0_4)) {
        SetEventFlag(TargetEventFlagType.EventFlag, X20_4, OFF);
        SetEventFlag(TargetEventFlagType.EventFlag, X24_4, OFF);
        SetEventFlag(TargetEventFlagType.EventFlag, X28_4, OFF);
        SetEventFlag(TargetEventFlagType.EventFlag, X32_4, OFF);
        SetEventFlag(TargetEventFlagType.EventFlag, X36_4, OFF);
        SetEventFlag(TargetEventFlagType.EventFlag, X40_4, OFF);
        EndEvent();
    }
L3:
    EndIf(EventValue(X12_4, 3) > X16_4);
    if (!EventFlag(9000)) {
        CreateAssetfollowingSFX(X8_4, 100, 6400);
    }
    WaitFor(EventFlag(X0_4) || (EventFlag(X4_4) && !EventFlag(9000)));
    RestartIf(EventFlag(X0_4));
    RestartIf(EventValue(X12_4, 3) > X16_4);
    CreateAssetfollowingSFX(X8_4, 100, 6400);
    if (X16_4 == 0) {
        SetEventFlag(TargetEventFlagType.EventFlag, X20_4, ON);
        EventValueOperation(X12_4, 3, 0, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X20_4, OFF);
    }
    if (X16_4 == 1) {
        SetEventFlag(TargetEventFlagType.EventFlag, X24_4, ON);
        EventValueOperation(X12_4, 3, 1, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X24_4, OFF);
    }
    if (X16_4 == 2) {
        SetEventFlag(TargetEventFlagType.EventFlag, X28_4, ON);
        EventValueOperation(X12_4, 3, 2, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X28_4, OFF);
    }
    if (X16_4 == 3) {
        SetEventFlag(TargetEventFlagType.EventFlag, X32_4, ON);
        EventValueOperation(X12_4, 3, 3, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X32_4, OFF);
    }
    if (X16_4 == 4) {
        SetEventFlag(TargetEventFlagType.EventFlag, X36_4, ON);
        EventValueOperation(X12_4, 3, 4, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X36_4, OFF);
    }
    if (X16_4 == 5) {
        SetEventFlag(TargetEventFlagType.EventFlag, X40_4, ON);
        EventValueOperation(X12_4, 3, 5, 0, 1, CalculationType.Assign);
    } else {
        SetEventFlag(TargetEventFlagType.EventFlag, X40_4, OFF);
    }
    WaitFor(EventValue(X12_4, 3) != X16_4 || EventFlag(X0_4));
    WaitFixedTimeFrames(1);
    RestartEvent();
});

$Event(1051362800, Restart, function() {
    if (EventFlag(1051360800) && !EventFlag(510830)) {
        WaitFixedTimeSeconds(1);
        DisplayBanner(TextBannerType.GreatEnemyFelled);
        WaitFixedTimeSeconds(4);
        AwardItemsIncludingClients(10830);
    }
    EndIf(EventFlag(1051360800));
    EndIf(EventFlag(9410) && !EventFlag(9413));
    WaitFor(CharacterHPValue(1051360800) <= 0);
    WaitFixedTimeSeconds(4);
    PlaySE(1051360800, SoundType.SFX, 888880000);
    WaitFor(CharacterDead(1051360800));
    WaitFixedTimeSeconds(4);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051360800, ON);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051362825, ON); //music handler eventflag
    SetEventFlag(TargetEventFlagType.EventFlag, 9183, ON);
    if (PlayerIsInOwnWorld()) {
        SetEventFlag(TargetEventFlagType.EventFlag, 61183, ON);
    }
    BonfirelikeRecovery();
    SetSpEffect(10000, 3450);
    HandleBossDefeatAndDisplayBanner(1051360800, TextBannerType.GreatEnemyFelled);
    WaitFixedTimeSeconds(6);
    SetEventFlag(TargetEventFlagType.EventFlag, 1051362825, OFF); //music handler eventflag
    SetEventFlag(TargetEventFlagType.EventFlag, 1051362805, OFF); //boss start eventflag OFF
    WaitFixedTimeFrames(1);
    TriggerAreaReload(false);
});

$Event(1051362810, Restart, function() {
    if (EventFlag(1051360800)) {
        ChangeCharacterEnableState(1051360800, Disabled);
        ChangeCharacterCollisionState(1051360800, Disabled);
        ForceCharacterDeath(1051360800, false);
        ChangeCharacterEnableState(1051360801, Disabled);
        ChangeCharacterCollisionState(1051360801, Disabled);
        ForceCharacterDeath(1051360801, false);
        ChangeCharacterEnableState(1051360802, Disabled);
        ChangeCharacterCollisionState(1051360802, Disabled);
        ForceCharacterDeath(1051360802, false);
        ChangeCharacterEnableState(1051360803, Disabled);
        ChangeCharacterCollisionState(1051360803, Disabled);
        ForceCharacterDeath(1051360803, false);
        ChangeCharacterEnableState(1051360804, Disabled);
        ChangeCharacterCollisionState(1051360804, Disabled);
        ForceCharacterDeath(1051360804, false);
        EndEvent();
    }
L0:
    ForceAnimationPlayback(1051360800, 703, true, false, true, Equal, 1);
    EnableCharacterInvincibility(1051360800);
    GotoIf(L5, !EventFlag(9410));
    GotoIf(L5, EventFlag(9413));
    ChangeCharacterEnableState(1051360800, Disabled);
    ChangeCharacterCollisionState(1051360800, Disabled);
    ForceCharacterDeath(1051360800, false);
    ChangeCharacterEnableState(1051360801, Disabled);
    ChangeCharacterCollisionState(1051360801, Disabled);
    ForceCharacterDeath(1051360801, false);
    ChangeCharacterEnableState(1051360802, Disabled);
    ChangeCharacterCollisionState(1051360802, Disabled);
    ForceCharacterDeath(1051360802, false);
    ChangeCharacterEnableState(1051360803, Disabled);
    ChangeCharacterCollisionState(1051360803, Disabled);
    ForceCharacterDeath(1051360803, false);
    ChangeCharacterEnableState(1051360804, Disabled);
    ChangeCharacterCollisionState(1051360804, Disabled);
    ForceCharacterDeath(1051360804, false);
    EndEvent();
L5:
    SetCharacterAIState(1051360801, Disabled);
    ChangeCharacterEnableState(1051360801, Disabled);
    SetCharacterAIState(1051360802, Disabled);
    ChangeCharacterEnableState(1051360802, Disabled);
    SetCharacterAIState(1051360803, Disabled);
    ChangeCharacterEnableState(1051360803, Disabled);
    ChangeCharacterEnableState(1051360804, Disabled);
    ChangeCharacterCollisionState(1051360804, Disabled);
    ForceCharacterDeath(1051360804, false);
    SetCharacterAIState(1051360800, Disabled);
    //WaitFor(EventFlag(1051362805) && cond && InArea(10000, 1051362800));
    IfInoutsideArea(MAIN, InsideOutsideState.Inside, 10000, 1051362800, 1);
    //SetCharacterAIState(1051360801, Enabled);
    //SetNetworkUpdateRate(1051360801, true, CharacterUpdateFrequency.AlwaysUpdate);
    //DisplayBossHealthBar(Enabled, 1051360801, 0, 903460501);
    CreateBulletOwner(1051360801);
    ForceAnimationPlayback(1051360800, 703, true, false, true, Equal, 1);
    ShootBullet(1051360801, 1051362810, -1, 240510700, 15, 180, 0);
    WaitFor(ElapsedSeconds(2.25));
    ForceAnimationPlayback(1051360800, 1703, false, false, true, Equal, 1);
    //IfCharacterHasSpEffect(MAIN, 1051360800, 5030, true, Equal, 1);
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 1051362805);
    DisableCharacterInvincibility(1051360800);
    SetCharacterAIState(1051360800, Enabled);
    SetNetworkUpdateRate(1051360800, true, CharacterUpdateFrequency.AlwaysUpdate);
    WaitFixedTimeSeconds(3);
    DisplayBossHealthBar(Enabled, 1051360800, 1, 902500510);
    SetCharacterHome(1051360800, 1051362299);
});

//$Event(1051362811, Restart, function() {
//    IfEventFlag(MAIN, OFF, TargetEventFlagType.EventFlag, 1051360800);
//    IfInoutsideArea(MAIN, InsideOutsideState.Inside, 10000, 1051362800, 1);
//    CreateBulletOwner(1051360801);
//    ShootBullet(1051360801, 1051362810, -1, 240510700, 15, 180, 0);
//    WaitFor(ElapsedSeconds(2));
//    ForceAnimationPlayback(1051360800, 1703, false, false, true, Equal, 1);
//});

$Event(1051362849, Restart, function() {
    EndIf(EventFlag(9410) && !EventFlag(9413));
    InitializeCommonEvent(0, 9005800, 1051360800, 1051361800, 1051362800, 1051362805, 1051365800, 10000, 0, 0);
    InitializeCommonEvent(0, 9005801, 1051360800, 1051361800, 1051362800, 1051362805, 1051362806, 10000);
    InitializeCommonEvent(0, 9005811, 1051360800, 1051361800, 5, 0);
    InitializeCommonEvent(0, 9005811, 1051360800, 1051361801, 3, 0);
    InitializeCommonEvent(0, 9005822, 1051360800, 921600, 1051362805, 1051362806, 0, 1051362802, 0, 0);
});

$Event(1051363700, Restart, function() {
    WaitFor(EventFlag(1051362702) && EventFlag(9410) && !EventFlag(9411));
    PlayCutsceneToPlayer(60510000, CutscenePlayMode.Skippable, 10000);
    WaitFixedTimeRealFrames(1);
    SetEventFlag(TargetEventFlagType.EventFlag, 9411, ON);
    EndEvent();
});

$Event(1051363710, Restart, function(X0_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    GotoIf(L19, !PlayerIsInOwnWorld());
    GotoIf(S0, !EventFlag(3660));
    SetEventFlag(TargetEventFlagType.EventFlag, 1043399303, OFF);
S0:
L19:
    if (!EventFlag(3667)) {
        ChangeCharacterEnableState(X0_4, Disabled);
        SetCharacterBackreadState(X0_4, true);
        WaitFor(EventFlag(3667));
        RestartEvent();
    }
L6:
    GotoIf(L1, EventFlag(3660));
    GotoIf(L2, EventFlag(3661));
    GotoIf(L4, EventFlag(3663));
L1:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    ForceAnimationPlayback(X0_4, 930010, false, false, false, Equal, 1);
    Goto(L20);
L2:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    SetCharacterTeamType(X0_4, TeamType.HostileNPC);
    Goto(L20);
L4:
    ForceCharacterTreasure(X0_4);
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    Goto(L20);
L20:
    WaitFor(!EventFlag(3667));
    RestartEvent();
});

$Event(1051363711, Restart, function() {
    EndIf(!PlayerIsInOwnWorld());
    EndIf(EventFlag(9412));
    WaitFor(EventFlag(9410));
    SetEventFlag(TargetEventFlagType.EventFlag, 3678, ON);
    EndEvent();
});

$Event(1051360720, Restart, function(X0_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    GotoIf(L19, !PlayerIsInOwnWorld());
    GotoIf(S0, !EventFlag(3600));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051369352, OFF);
S0:
L19:
    GotoIf(L11, EventFlag(3611));
    GotoIf(L12, EventFlag(3612));
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    WaitFor(AnyBatchEventFlags(3611, 3612));
    RestartEvent();
L11:
L12:
    GotoIf(L1, EventFlag(3601));
    GotoIf(L2, EventFlag(3602));
    GotoIf(L3, EventFlag(3603));
    SetCharacterBackreadState(X0_4, false);
    ChangeCharacterEnableState(X0_4, Enabled);
    ForceAnimationPlayback(X0_4, 930010, false, false, false, Equal, 1);
    Goto(L20);
L1:
L2:
L3:
    SetCharacterBackreadState(X0_4, true);
    ChangeCharacterEnableState(X0_4, Disabled);
    Goto(L20);
L20:
    WaitFor(!AnyBatchEventFlags(3611, 3612));
    RestartEvent();
});

$Event(1051360721, Restart, function() {
    EndIf(!PlayerIsInOwnWorld());
    EndIf(EventFlag(9412));
    WaitFor(AnyBatchEventFlags(3605, 3610) && EventFlag(9410));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051362739, ON);
    SetEventFlag(TargetEventFlagType.EventFlag, 3618, ON);
});

$Event(1051363725, Restart, function(X0_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    GotoIf(L10, !PlayerIsInOwnWorld());
    GotoIf(S0, !(EventFlag(3360) && EventFlag(1051369203)));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051369203, OFF);
S0:
L10:
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    SetAssetInvulnerability(1051361700, Disabled);
    if (!(EventFlag(3365) || EventFlag(3367))) {
        WaitFor(EventFlag(3365) || EventFlag(3367));
        RestartEvent();
    }
L0:
    GotoIf(L1, EventFlag(3360));
    GotoIf(L2, EventFlag(3361));
    GotoIf(L4, EventFlag(3363));
L1:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    ForceAnimationPlayback(X0_4, 90100, false, false, false, Equal, 1);
    SetCharacterGravity(X0_4, Disabled);
    SetAssetInvulnerability(1051361700, Enabled);
    Goto(L20);
L2:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    SetCharacterTeamType(X0_4, TeamType.HostileNPC);
    Goto(L20);
L4:
    ForceCharacterTreasure(X0_4);
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    ChangeAssetEnableState(X0_4, Disabled);
    Goto(L20);
L20:
    WaitFor(!(EventFlag(3365) || EventFlag(3367)));
    RestartEvent();
});

$Event(1051363726, Restart, function(X0_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    GotoIf(L10, !PlayerIsInOwnWorld());
    GotoIf(S0, !(EventFlag(3360) && EventFlag(1051369203)));
    SetEventFlag(TargetEventFlagType.EventFlag, 1051369203, OFF);
S0:
L10:
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    if (!EventFlag(3366)) {
        WaitFor(EventFlag(3366));
        RestartEvent();
    }
L0:
    GotoIf(L1, EventFlag(3360));
    GotoIf(L2, EventFlag(3361));
    GotoIf(L4, EventFlag(3363));
L1:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    ForceAnimationPlayback(X0_4, 90101, false, false, false, Equal, 1);
    Goto(L20);
L2:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    SetCharacterTeamType(X0_4, TeamType.HostileNPC);
    Goto(L20);
L4:
    ForceCharacterTreasure(X0_4);
    ChangeCharacterEnableState(X0_4, Disabled);
    SetCharacterBackreadState(X0_4, true);
    ChangeAssetEnableState(X0_4, Disabled);
    Goto(L20);
L20:
    WaitFor(!EventFlag(3366));
    RestartEvent();
});

$Event(1051363727, Restart, function() {
    EndIf(!PlayerIsInOwnWorld());
    SetCharacterTalkRange(1051360701, 17);
    EndIf(EventFlag(9413));
    SetCharacterTalkRange(1051360701, 80);
    WaitFor(EventFlag(3366) && !EventFlag(1051362701) && InArea(10000, 1051362701));
    SetNetworkconnectedEventFlag(TargetEventFlagType.EventFlag, 1051362700, ON);
    EndEvent();
});

$Event(1051360730, Restart, function(X0_4, X4_4, X8_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    if (PlayerIsInOwnWorld()) {
        SetSpEffect(X0_4, 5005);
    }
L19:
    if (!(EventFlag(9410) && !EventFlag(9413))) {
        ChangeCharacterEnableState(X0_4, Disabled);
        SetCharacterBackreadState(X0_4, true);
        WaitFor(EventFlag(9410) && !EventFlag(9413));
        RestartEvent();
    }
L0:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    ForceAnimationPlayback(X0_4, X4_4, false, false, false, Equal, 1);
    if (X8_4 != 0) {
        ChangeCharacterCollisionState(X0_4, Disabled);
    }
    WaitFor(!(EventFlag(9410) && !EventFlag(9413)));
    RestartEvent();
});

$Event(1051360734, Restart, function(X0_4) {
    EndIf(!PlayerIsInOwnWorld());
    SetSpEffect(X0_4, 5005);
    WaitFor(
        EventFlag(9410)
            && !EventFlag(9413)
            && ActionButtonInArea(6000, X0_4)
            && PlayerIsInOwnWorld());
    ForceAnimationPlayback(X0_4, 90203, false, false, false, Equal, 1);
    WaitFixedTimeSeconds(2.5);
    if (!EventFlag(60801)) {
        AwardGesture(1);
        SetEventFlag(TargetEventFlagType.EventFlag, 60801, ON);
    }
});

$Event(1051360735, Restart, function(X0_4, X4_4, X8_4) {
    SetNetworkSyncState(Disabled);
    WaitFixedTimeFrames(1);
    if (PlayerIsInOwnWorld()) {
        SetSpEffect(X0_4, 5005);
        if (!EventFlag(7606)) {
            SetNetworkconnectedEventFlag(TargetEventFlagType.EventFlag, 1051362735, ON);
        }
    }
L19:
    if (!(EventFlag(9410) && !EventFlag(9413) && EventFlag(1051362735))) {
        ChangeCharacterEnableState(X0_4, Disabled);
        SetCharacterBackreadState(X0_4, true);
        WaitFor(EventFlag(9410) && !EventFlag(9413) && EventFlag(1051362735));
        RestartEvent();
    }
L0:
    ChangeCharacterEnableState(X0_4, Enabled);
    SetCharacterBackreadState(X0_4, false);
    ForceAnimationPlayback(X0_4, X4_4, false, false, false, Equal, 1);
    if (X8_4 != 0) {
        ChangeCharacterCollisionState(X0_4, Disabled);
    }
    WaitFor(!(EventFlag(9410) && !EventFlag(9413) && EventFlag(1051362735)));
    RestartEvent();
});

// Archer Tower Spawn
$Event(1051360736, Restart, function() {
    EndIf(EventFlag(1051360201));
    DisableCharacterAI(1051360201);
    parkour |= InArea(10000, 1051362207);
    WaitFor(InArea(10000, 1051362201) || HasDamageType(1051360201, 10000, DamageType.Unspecified) || parkour);
    EnableCharacterAI(1051360201);
    if (parkour.Passed){
        IssueShortWarpRequest(1051360201, TargetEntityType.Area, 1051361201, -1);
    }
});
