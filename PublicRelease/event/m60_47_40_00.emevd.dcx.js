// ==EMEVD==
// @docs    er-common.emedf.json
// @compress    DCX_KRAK
// @game    Sekiro
// @string    "N:\\GR\\data\\Param\\event\\common_func.emevd\u0000N:\\GR\\data\\Param\\event\\common_macro.emevd\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0,82]
// @version    3.4.2
// ==/EMEVD==

$Event(0, Default, function() {
    RegisterBonfire(1047400900, 1047401950, 0, 0, 0, 5);
    InitializeCommonEvent(0, 9005810, 1047400800, 1047400000, 1047400951, 1047401951, 1084227584); //guardian grace
    InitializeCommonEvent(0, 90005100, 76418, 76403, 1047401980, 77400, 1, 78400, 78401, 78402, 78403, 78404, 78405, 78406, 78407, 78408, 78409);
    InitializeCommonEvent(0, 90005694, 1047402502, 1047401502, 200, 0, 802004000, 1065353216, 0, 1065353216);
    InitializeCommonEvent(0, 90005694, 1047402506, 1047401506, 200, 0, 802004000, 1065353216, 0, 1065353216);
    InitializeCommonEvent(0, 90005694, 1047402507, 1047401507, 200, 0, 802004000, 1065353216, 0, 1065353216);
    InitializeCommonEvent(0, 90005694, 1047402511, 1047401511, 200, 0, 802004000, 1065353216, 0, 1065353216);
    InitializeCommonEvent(0, 90005694, 1047402512, 1047401512, 200, 0, 802004000, 1065353216, 0, 1065353216);
    InitializeCommonEvent(0, 90005683, 62410, 1047401684, 207, 78490, 78490);
    InitializeCommonEvent(0, 90005620, 1047400570, 1047401570, 1047401571, 0, 1047402570, 1047402571, 1047402572);
    InitializeCommonEvent(0, 90005621, 1047400570, 1047401573);
    InitializeCommonEvent(0, 90005250, 1047400256, 1047402259, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400259, 1047402259, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400260, 1047402260, 0, -1);
    InitializeCommonEvent(0, 90005300, 1047400290, 1047400290, 40400, 0, 0);
    InitializeEvent(0, 1047402399, 0);
    InitializeCommonEvent(0, 90005250, 1047400399, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400300, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400301, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400302, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400303, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400304, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400305, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400306, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400307, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400308, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400309, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400310, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400311, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400312, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400313, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400314, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400315, 1047402399, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400321, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400322, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400323, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400324, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400325, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400326, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400327, 1047402321, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400328, 1047402321, 0, -1);
    InitializeEvent(0, 1047402302, 0);
    InitializeCommonEvent(0, 90005250, 1047400336, 1047402336, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400337, 1047402336, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400338, 1047402336, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400339, 1047402336, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400340, 1047402340, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400341, 1047402340, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400342, 1047402340, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400354, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400355, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400402, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400403, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400405, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400407, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400408, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400409, 1047402402, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400410, 1047402336, 0, -1);
    InitializeCommonEvent(0, 90005250, 1047400468, 1047402468, 0, -1);
    InitializeCommonEvent(0, 90005251, 1047400391, 1114636288, 0, -1);
    //InitializeCommonEvent(0, 90005870, 1047400800, 904810600, 18);
    //InitializeCommonEvent(0, 90005860, 1047400800, 0, 1047400800, 0, 30410, 0);
    //Erdtree Boss
    InitializeCommonEvent(0, 90005876, 1047400800, 1047400801, 904810651, 920100);
    InitializeCommonEvent(0, 90005875, 1047400800, 30410, 920100);
    InitializeCommonEvent(0, 90005890, 1047400800, 1047400801, 1047400801);
    InitializeCommonEvent(0, 90005891, 1047400800, 1047400801, 1047400802);
    InitializeEvent(0, 1047402310, 0);
    InitializeEvent(0, 1047402311, 1047400803, 30);
    InitializeEvent(1, 1047402311, 1047400804, 31);
    InitializeEvent(2, 1047402311, 1047400805, 905);
    //Erdtree Warps - Enemy, Obj, Guardian
    InitializeCommonEvent(0, 9005995, 1047400751, 1047400725, 1047400800);
    InitializeEvent(0, 98005303, 1047400801, 1047400803);
    InitializeEvent(0, 98005304, 1047400801, 1047400803);
});

$Event(1047402301, Restart, function(X0_4, X4_4, X8_4) {
    WaitFor(InArea(X0_4, X4_4));
    ChangeCharacterPatrolBehavior(X0_4, X8_4);
});

$Event(1047402302, Restart, function() {
    ChangeCharacterEnableState(1047400300, Disabled);
    ChangeCharacterEnableState(1047400301, Disabled);
    ChangeCharacterEnableState(1047400302, Disabled);
    ChangeCharacterEnableState(1047400303, Disabled);
    ChangeCharacterEnableState(1047400304, Disabled);
    ChangeCharacterEnableState(1047400305, Disabled);
    ChangeCharacterEnableState(1047400306, Disabled);
    ChangeCharacterEnableState(1047400307, Disabled);
    ChangeCharacterEnableState(1047400308, Disabled);
    ChangeCharacterEnableState(1047400309, Disabled);
    ChangeCharacterEnableState(1047400310, Disabled);
    ChangeCharacterEnableState(1047400311, Disabled);
    ChangeCharacterEnableState(1047400312, Disabled);
    ChangeCharacterEnableState(1047400313, Disabled);
    ChangeCharacterEnableState(1047400314, Disabled);
    ChangeCharacterEnableState(1047400315, Disabled);
    WaitFor(InArea(10000, 1047402399));
    ChangeCharacterEnableState(1047400300, Enabled);
    ChangeCharacterEnableState(1047400301, Enabled);
    ChangeCharacterEnableState(1047400302, Enabled);
    ChangeCharacterEnableState(1047400303, Enabled);
    ChangeCharacterEnableState(1047400304, Enabled);
    ChangeCharacterEnableState(1047400305, Enabled);
    ChangeCharacterEnableState(1047400306, Enabled);
    ChangeCharacterEnableState(1047400307, Enabled);
    ChangeCharacterEnableState(1047400308, Enabled);
    ChangeCharacterEnableState(1047400309, Enabled);
    ChangeCharacterEnableState(1047400310, Enabled);
    ChangeCharacterEnableState(1047400311, Enabled);
    ChangeCharacterEnableState(1047400312, Enabled);
    ChangeCharacterEnableState(1047400313, Enabled);
    ChangeCharacterEnableState(1047400314, Enabled);
    ChangeCharacterEnableState(1047400315, Enabled);
});

// Move set handler jar boss
$Event(1047402310, Restart, function() {
    WaitFor(HPRatio(1047400800) <= 0.6); // HP check

    SetSpEffect(1047400800, 15211); // Allow Ironjar
    
    WaitFor(CharacterHasSpEffect(1047400800, 15209)); // Ironjar Applied
    ClearSpEffect(1047400800, 15211); // Remove ironjar override to go back to alexander moveset
    WaitFor(!CharacterHasSpEffect(1047400800, 15212)); // Wait for cooldown of ironjar 
    RestartEvent(); 
});

// Exploding Jar upon Jar boss death
$Event(1047402311, Restart, function(X0_4, X4_4) {
    DisableCharacter(X0_4);
    
    if (EventFlag(1047400800)) {
        DisableCharacterCollision(X0_4);
        ForceCharacterDeath(X0_4, false);
        EndEvent();
    }
    DisableCharacterAI(X0_4);
    WaitFor(HPRatio(1047400800) == 0);
    
    EnableCharacter(X0_4);
    IssueShortWarpRequest(X0_4, TargetEntityType.Character, 1047400800, 31);
    WaitRandomTimeFrames(0, 75);
    EnableCharacterAI(X0_4);
});

$Event(1047402399, Restart, function() {
    WaitFor(InArea(1047400399, 1046402399));
    WaitFixedTimeSeconds(30);
    ChangeCharacterPatrolBehavior(1047400399, 1046403201);
});
